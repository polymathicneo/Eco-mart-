// Dynamic content functionality for EcoMart website
// This file contains JavaScript functions for interactive features

// Blog expansion functionality
const blogContent = {
    0: {
        title: "The Hidden Carbon Footprint of Your Digital Life",
        fullContent: `
            <p>We often think of pollution as being physicalâ€”exhaust, trash, or sludge. But our digital habits have a massive environmental impact too. Every email sent, every movie streamed, and every photo stored in the cloud requires energy. This energy powers the massive data centers that keep the internet running, and much of it still comes from fossil fuels.</p>

            <h4>The Cost of Streaming and Cloud Storage</h4>
            <p>Video streaming is one of the biggest contributors to internet traffic. Higher resolution means more data, which means more energy. Binge-watching a series in 4K might seem harmless, but the server farms delivering that content run 24/7, consuming electricity for both operation and cooling. Similarly, cloud storage feels infinite, but it relies on physical infrastructure. We often store thousands of old photos and files we never look at, forcing data centers to keep spinning hard drives for "digital hoarders."</p>

            <h4>Electronic Waste (E-Waste)</h4>
            <p>Beyond energy consumption, our hunger for the latest gadgets creates a mountain of e-waste. Smartphones, laptops, and tablets are often discarded after just a few years.
            According to the UN, the world generates over 50 million tonnes of e-waste annually, and only a fraction is properly recycled. Toxic materials like lead, mercury, and cadmium from these devices leach into soil and water constitutes a major health hazard.</p>

            <h4>Strategies for a Greener Digital Life</h4>
            <ul>
                <li><strong>Clean Up Your Cloud:</strong> Delete old emails, blurry photos, and unused files. Less data stored means less energy used.</li>
                <li><strong>Stream Smart:</strong> Lower your streaming quality on small screens. You don't need 4K resolution on a 6-inch phone.</li>
                <li><strong>Extend Device Life:</strong> Repair before you replace. Keep your phone for 3-4 years instead of upgrading annually.</li>
                <li><strong>Choose Green Hosting:</strong> If you run a website, choose a hosting provider that runs on renewable energy.</li>
            </ul>

            <p>The internet is an incredible tool, but it's not resource-free. By being mindful of our digital consumption, we can reduce our virtual carbon footprint significantly.</p>
        `
    },
    1: {
        title: "The Ultimate Guide to a Zero-Waste Kitchen",
        fullContent: `
            <p>The kitchen is often the biggest source of household waste, from food scraps to single-use packaging. Adopting a zero-waste mindset doesn't happen overnight, but small changes can make a huge difference. Here is a comprehensive guide to transforming your kitchen into an eco-friendly hub.</p>

            <h4>1. Audit Your Trash</h4>
            <p>Before you can reduce waste, you need to know what you are throwing away. Spend a week observing your trash bin. Is it mostly food scraps? Plastic wrap? Paper towels? Identifying the main culprits is the first step toward finding sustainable alternatives.</p>

            <h4>2. Swap Single-Use for Reusable</h4>
            <ul>
                <li><strong>Paper Towels:</strong> Switch to reusable cloth rags or Swedish dishcloths. They are washable, durable, and save money in the long run.</li>
                <li><strong>Plastic Wrap:</strong> Use beeswax wraps or silicone lids. They keep food fresh without filling up the landfill.</li>
                <li><strong>Ziploc Bags:</strong> Invest in silicone stasher bags or simply wash and reuse your plastic sealable bags until they break.</li>
            </ul>

            <h4>3. Master the Art of Composting</h4>
            <p>Food waste that ends up in landfills releases methane, a potent greenhouse gas. Composting turns your vegetable peels, coffee grounds, and eggshells into nutrient-rich soil. If you don't have a garden, looking for local community composting drop-off points or use an under-sink worm bin.</p>

            <h4>4. Bulk Buying and Storage</h4>
            <p>Buying in bulk reduces packaging waste and is often cheaper. Bring your own glass jars or cotton bags to the store. Store dry goods like rice, pasta, and lentils in airtight glass containers to keep them fresh and visible (so you don't overbuy).</p>

            <h4>5. Mindful Shopping</h4>
            <p>Plan your meals to avoid buying food that will go bad. "Shop" your pantry first before heading to the store. Choose loose produce instead of pre-packaged fruits and vegetables. Every piece of plastic you refuse is a vote for a cleaner planet.</p>
        `
    },
    2: {
        title: "Why Bamboo is the Superplant of the Future",
        fullContent: `
            <p>Bamboo is having a moment. From flooring to underwear, toothbrushes to skyscrapers, this giant grass is everywhere. But is it really the sustainable savior it's claimed to be? The short answer is yesâ€”if harvested responsibly.</p>

            <h4>Rapid Regeneration</h4>
            <p>Bamboo is the fastest growing plant on Earth. Some species can grow up to 3 feet in a 24-hour period! Unlike trees like oak or pine, which can take 30-50 years to mature, bamboo can be harvested in just 3-5 years. Crucially, when you cut bamboo, the root system remains intact, and the plant regrows from the same root. This prevents soil erosion and eliminates the need for replanting.</p>

            <h4>Carbon Sequestration Specialist</h4>
            <p>Bamboo is a carbon-absorbing powerhouse. It absorbs twice as much carbon dioxide as trees and releases 30% more oxygen into the atmosphere. A bamboo grove acts as a massive carbon sink, helping to mitigate the effects of climate change more efficiently than many other types of forest.</p>

            <h4>Versatility Unmatched</h4>
            <p>The strength-to-weight ratio of bamboo rivals steel, making it excellent for construction. Its fibers are soft enough to be spun into luxurious fabrics that are naturally antibacterial and moisture-wicking. At EcoMart, we use bamboo for our water bottles and cleaning brushes because it's durable, biodegradable, and beautiful.</p>

            <h4>The Caveat: Processing Matters</h4>
            <p>Not all bamboo products are created equal. While mechanical processing (for wood-like uses) is generally eco-friendly, chemical processing (for some rayon fabrics) can be intensive. It's important to look for certifications and choose brands that are transparent about their manufacturing processes.</p>
        `
    },
    3: {
        title: "Sustainable Fashion: Beyond the Buzzwords",
        fullContent: `
            <p>"Sustainable Fashion" is a trendy term, but what does it actually mean? The fashion industry is currently responsible for about 10% of global carbon emissionsâ€”more than all international flights and maritime shipping combined. Shifting to a sustainable model isn't just a preference; it's a necessity.</p>

            <h4>The Problem with Fast Fashion</h4>
            <p>Fast fashion is built on speed and low cost. Brands churn out 52 micro-seasons a year, encouraging consumers to buy cheap, wear once, and discard. These clothes are often made from synthetic fibers like polyester (essentially plastic), which shed microplastics when washed and don't biodegrade in landfills.</p>

            <h4>Fabrics of the Future</h4>
            <ul>
                <li><strong>Organic Cotton:</strong> Grown without harmful pesticides and uses less water than conventional cotton.</li>
                <li><strong>Hemp:</strong> Extremely durable, requires little water, and actually improves soil health.</li>
                <li><strong>Tencel/Lyocell:</strong> Made from wood pulp in a closed-loop system where chemicals and water are reused.</li>
                <li><strong>Recycled Polyester:</strong> Gives a second life to plastic bottles, though it still sheds microplastics.</li>
            </ul>

            <h4>The "Slow Fashion" Movement</h4>
            <p>The most sustainable garment is the one already in your closet. Slow fashion is about buying less, choosing higher quality, and caring for your clothes so they last longer. It means mending a tear instead of tossing the shirt, and buying vintage or second-hand when you do need something "new."</p>

            <p>At EcoMart, we champion local artisans like those making our Pashmina shawls. These items are handmade with care, support traditional livelihoods, and are built to last a lifetimeâ€”the antithesis of disposable fashion.</p>
        `
    },
    4: {
        title: "The Global Plastic Crisis & YOU",
        fullContent: `
            <p>We are living in the Plastic Age. Since the 1950s, we have produced over 8.3 billion metric tons of plastic. Shockingly, about 79% of that has ended up in landfills or the natural environment. The convenience of plastic has come at a devastating ecological cost.</p>

            <h4>Oceans of Plastic</h4>
            <p>Every minute, one garbage truck worth of plastic is dumped into our oceans. This debris harms marine life through entanglement and ingestion. The Great Pacific Garbage Patch is now three times the size of France. But the bigger problem is what you can't easily see: microplastics.</p>

            <h4>The Microplastic Threat</h4>
            <p>Plastic doesn't biodegrade; it photodegrades, breaking down into smaller and smaller pieces. These microplastics have infiltrated every corner of the globe, from the Mariana Trench to the summit of Mt. Everest. They are in the water we drink, the food we eat, and even the air we breathe. Research is still ongoing about the long-term health effects on humans, but the prognosis isn't good.</p>

            <h4>Turning the Tide</h4>
            <p>Recycling alone won't save usâ€”current recycling rates are too low. The solution lies in "Refuse and Reduce."</p>
            <ul>
                <li>Refuse single-use straws, cutlery, and bags.</li>
                <li>Choose products packaged in glass, metal, or paper.</li>
                <li>Support bans on single-use plastics in your local community.</li>
                <li>Participate in local beach or park cleanups.</li>
            </ul>

            <p>Individual action sends a signal to corporations. When we stop buying over-packaged goods, companies are forced to innovate. Your wallet is your most powerful vote.</p>
        `
    },
    5: {
        title: "Smart Homes, Greener Planet",
        fullContent: `
            <p>Can high-tech gadgets actually help the planet? It seems counterintuitiveâ€”more devices mean more e-waste and energy use. However, the rise of "Smart Home" technology offers unique opportunities to optimize our energy consumption and reduce waste in ways that manual habits struggle to match.</p>

            <h4>Intelligent Energy Management</h4>
            <p>Smart thermostats (like Nest or Ecobee) learn your schedule. They heat or cool the house only when you are there, and lower the energy usage when you're asleep or away. Studies show this can reduce HVAC energy use by 10-15%. Similarly, smart lighting systems allow you to schedule lights to turn off automatically or control them remotely if you forgot to flip the switch.</p>

            <h4>Water Conservation</h4>
            <p>Smart irrigation controllers monitor local weather forecasts. They won't water your lawn if it's about to rain, potentially saving thousands of gallons of water annually. Smart leak detectors can alert you to a burst pipe instantly, preventing massive water waste (and damage) that might otherwise go unnoticed for hours.</p>

            <h4>The Grid of the Future</h4>
            <p>As we move toward renewable energy, smart appliances will play a crucial role. They can communicate with the power grid to run energy-intensive tasks (like the dishwasher or EV charging) during off-peak hours when renewable energy production is high and demand is low.</p>

            <h4>The Jevons Paradox</h4>
            <p>A word of caution: efficiency can lead to increased consumption (the Jevons Paradox). Just because your lights are LED and smart doesn't mean you should leave them on all the time. Technology is a tool to assist our sustainable choices, not replace them. The greenest smart home is still one where the user is mindful of their impact.</p>
        `
    }
};

/**
 * Toggles the expanded view of a blog post
 * @param {number} index - Index of the blog post in the array
 */
function toggleBlogPost(index) {
    const blogCard = document.querySelectorAll('.blog-card')[index];
    const readMoreLink = blogCard.querySelector('.read-more');
    const content = blogCard.querySelector('p');

    // Check if already expanded
    if (blogCard.classList.contains('expanded')) {
        // Collapse
        content.innerHTML = content.dataset.shortContent;
        readMoreLink.textContent = 'Read Full Article â†’';
        blogCard.classList.remove('expanded');
    } else {
        // Expand
        if (!content.dataset.shortContent) {
            content.dataset.shortContent = content.innerHTML;
        }

        content.innerHTML = blogContent[index].fullContent;
        readMoreLink.textContent = 'Read Less â†';
        blogCard.classList.add('expanded');
    }
}

/**
 * Updates cart counter display in header
 */
function updateCartCounter() {
    const cartCounter = document.getElementById('cart-counter');
    if (!cartCounter) return;

    // Get cart count from localStorage
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const count = cart.reduce((total, item) => total + item.quantity, 0);

    // Update counter text
    cartCounter.textContent = count;

    // Show/hide counter based on cart contents
    if (count > 0) {
        cartCounter.style.display = 'inline-flex';
    } else {
        cartCounter.style.display = 'none';
    }
}

/**
 * Creates a theme toggle button
 */
function createThemeToggle() {
    const header = document.querySelector('header');
    if (!header) return;

    const themeButton = document.createElement('button');
    themeButton.id = 'theme-toggle';
    themeButton.innerHTML = 'ðŸŒ™';
    themeButton.title = 'Toggle Dark Mode';
    themeButton.style.cssText = `
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 10px;
        border-radius: 50%;
        transition: background-color 0.3s;
    `;

    themeButton.addEventListener('mouseenter', () => {
        themeButton.style.backgroundColor = 'rgba(0,0,0,0.1)';
    });

    themeButton.addEventListener('mouseleave', () => {
        themeButton.style.backgroundColor = 'transparent';
    });

    header.style.position = 'relative';
    header.appendChild(themeButton);

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeButton.innerHTML = 'â˜€ï¸';
    }

    themeButton.addEventListener('click', toggleTheme);
}

/**
 * Toggles between light and dark themes
 */
function toggleTheme() {
    const body = document.body;
    const themeButton = document.getElementById('theme-toggle');

    if (body.classList.contains('dark-theme')) {
        body.classList.remove('dark-theme');
        themeButton.innerHTML = 'ðŸŒ™';
        localStorage.setItem('theme', 'light');
    } else {
        body.classList.add('dark-theme');
        themeButton.innerHTML = 'â˜€ï¸';
        localStorage.setItem('theme', 'dark');
    }
}

/**
 * Handles newsletter subscription with popup confirmation
 * @param {Event} event - Form submit event
 */
function handleNewsletterSubscription(event) {
    event.preventDefault();

    const form = event.target;
    const email = form.querySelector('input[type="email"]').value;

    if (!email) {
        alert('Please enter your email address');
        return;
    }

    // Show confirmation popup
    const confirmed = confirm(`Subscribe "${email}" to our newsletter?\n\nYou'll receive updates on sustainable products and eco-friendly tips.`);

    if (confirmed) {
        // Simulate subscription (in real app, this would send to server)
        alert('Thank you for subscribing! ðŸŽ‰\n\nWelcome to the EcoMart community.');
        form.reset();

        // Show success message
        showNotification('Successfully subscribed to newsletter!', 'success');
    }
}

/**
 * Shows a notification message to the user
 * @param {string} message - Message to display
 * @param {string} type - Type of notification (success, error, info)
 */
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
        color: white;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        font-weight: bold;
        animation: slideIn 0.3s ease-out;
    `;

    document.body.appendChild(notification);

    // Remove notification after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Product Data for Modal
const productDetails = {
    "Lokta Paper Notebook": {
        description: "Experience the unique texture of traditional Nepali Lokta paper. This eco-friendly notebook is handmade from the bark of the Lokta bush, which grows in the Himalayas. It's naturally resistant to insects and moisture, making it perfect for long-term journaling.",
        features: ["Handmade in Nepal", "Sustainable Lokta bark", "Acid-free paper", "Durable and unique texture"],
        price: "Rs. 650"
    },
    "Natural Hemp Bag": {
        description: "Our eco-friendly hemp bags are hand-woven by local artisans in Nepal. Hemp is one of the most sustainable fibers on Earth, requiring very little water and no pesticides to grow. This bag is strong, durable, and gets softer with every wash.",
        features: ["100% Organic Hemp", "Hand-woven in Nepal", "Biodegradable", "Extra durable design"],
        price: "Rs. 950"
    },
    "Authentic Pashmina Shawl": {
        description: "Wrap yourself in luxury with our authentic Pashmina shawl. Sourced from the high-altitude Himalayan goats, this wool is incredibly soft and warm. Every shawl is hand-spun and hand-woven using traditional techniques passed down through generations.",
        features: ["Grade-A Pashmina Wool", "Hand-woven artisans", "Extremely lightweight and warm", "Traditional Nepali patterns"],
        price: "Rs. 2500"
    },
    "Natural Organic Fertilizer": {
        description: "Give your garden the best with our 100% natural organic fertilizer. Made from local composted materials, it enriches the soil with essential nutrients without any harsh chemicals. Safe for children, pets, and the environment.",
        features: ["Chemical-free", "Made from organic waste", "Improves soil structure", "Safe for all plants"],
        price: "Rs. 280"
    },
    "Traditional Dhaka Topi": {
        description: "Wear a piece of Nepali culture. This traditional Dhaka Topi is hand-woven with intricate patterns known as Dhaka. It's a symbol of national pride and a testament to the skill of Nepali weavers.",
        features: ["Hand-woven Dhaka fabric", "Traditional cultural design", "Breathable material", "Symbol of Nepal"],
        price: "Rs. 450"
    },
    "Copper Water Bottle": {
        description: "Stay hydrated the traditional way. Drinking water stored in a copper vessel has many health benefits according to Ayurveda. Our bottles are handcrafted from pure copper and designed to last a lifetime.",
        features: ["Pure high-grade copper", "Handcrafted in Nepal", "Natural antimicrobial properties", "Sustainable alternative to plastic"],
        price: "Rs. 1199"
    },
    "Bamboo Water Bottle": {
        description: "Combines modern insulation with sustainable materials. This bottle features a stainless steel interior and a beautiful, natural bamboo exterior. Keeps drinks hot for 12 hours or cold for 24 hours.",
        features: ["Natural Bamboo exterior", "Double-walled vacuum insulation", "BPA-free", "Sleek eco-design"],
        price: "Rs. 2450"
    },
    "Organic Cotton Tote Bag": {
        description: "The ultimate reusable bag. Made from heavy-duty organic cotton, this tote is strong enough for your groceries and stylish enough for daily use. Say goodbye to single-use plastic bags forever.",
        features: ["100% Organic Cotton", "Heavy-duty 12oz fabric", "Long handles for comfort", "Machine washable"],
        price: "Rs. 1100"
    },
    "Bamboo Toothbrush Set": {
        description: "Switch to a cleaner, greener smile. Our bamboo toothbrushes have biodegradable handles and soft, BPA-free bristles. Each pack contains 4 brushes with unique markings so family members won't mix them up.",
        features: ["Biodegradable bamboo handle", "BPA-free bristles", "Pack of 4", "Recyclable packaging"],
        price: "Rs. 1300"
    },
    "Beeswax Food Wraps": {
        description: "The sustainable alternative to plastic wrap. These wraps are made from organic cotton infused with beeswax, jojoba oil, and tree resin. Simply use the warmth of your hands to seal over bowls or wrap around produce.",
        features: ["Organic ingredients", "Reusable up to a year", "Compostable", "Antibacterial properties"],
        price: "Rs. 1680"
    }
};

/**
 * Opens the product modal with specific product information
 */
function openProductModal(name, imgSrc) {
    const modal = document.getElementById('productModal');
    const details = productDetails[name];

    if (!details) return;

    document.getElementById('modalTitle').textContent = name;
    document.getElementById('modalImg').src = imgSrc;
    document.getElementById('modalPrice').textContent = details.price;
    document.getElementById('modalDesc').textContent = details.description;

    const featuresList = document.getElementById('modalFeatures');
    featuresList.innerHTML = '';
    details.features.forEach(feature => {
        const li = document.createElement('li');
        li.textContent = feature;
        featuresList.appendChild(li);
    });

    // Update modal button callback
    const buyBtn = document.getElementById('modalBuyBtn');
    buyBtn.onclick = () => {
        if (typeof addToCart === 'function') {
            addToCart(name, details.price, imgSrc);
        }
        closeProductModal();
    };

    modal.style.display = 'block';
    document.body.style.overflow = 'hidden'; // Prevent scrolling
}

/**
 * Closes the product modal
 */
function closeProductModal() {
    const modal = document.getElementById('productModal');
    modal.style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close modal when clicking outside of it
window.onclick = function (event) {
    const modal = document.getElementById('productModal');
    if (event.target == modal) {
        closeProductModal();
    }
};

// Initialize dynamic content when DOM is loaded
document.addEventListener('DOMContentLoaded', function () {
    // Add click handlers to blog read more links
    const readMoreLinks = document.querySelectorAll('.read-more');
    readMoreLinks.forEach((link, index) => {
        link.addEventListener('click', function (e) {
            e.preventDefault();
            toggleBlogPost(index);
        });
    });

    // Add click handlers to product cards (excluding the buy button)
    const productCards = document.querySelectorAll('.item-card');
    productCards.forEach(card => {
        card.style.cursor = 'pointer';
        card.addEventListener('click', function (e) {
            // Don't open modal if they clicked the 'Add to Cart' button directly
            if (e.target.classList.contains('buy-btn')) return;

            const name = card.querySelector('h3').textContent;
            const imgSrc = card.querySelector('img').src;
            openProductModal(name, imgSrc);
        });
    });

    // Update cart counter
    updateCartCounter();

    // Create theme toggle
    createThemeToggle();

    // Add dark theme styles
    const style = document.createElement('style');
    style.textContent = `
        .dark-theme {
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .dark-theme .blog-card,
        .dark-theme .contact-container {
            background-color: #2d2d2d;
            color: #ffffff;
        }

        .dark-theme .blog-card h3,
        .dark-theme label {
            color: #90EE90;
        }

        .dark-theme input,
        .dark-theme textarea {
            background-color: #3d3d3d;
            border-color: #555;
            color: #ffffff;
        }

        .dark-theme input:focus,
        .dark-theme textarea:focus {
            border-color: #90EE90;
            box-shadow: 0 0 0 2px rgba(144, 238, 144, 0.2);
        }

        .cart-counter {
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 5px;
        }

        .blog-card.expanded {
            animation: expand 0.3s ease-in-out;
        }

        @keyframes expand {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }
    `;
    document.head.appendChild(style);
});

// Update cart counter when cart changes (for other pages)
window.addEventListener('storage', function (e) {
    if (e.key === 'cart') {
        updateCartCounter();
    }
});
